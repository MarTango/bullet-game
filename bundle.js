!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e),n.d(e,"Bullet",(function(){return i}));var r=({board:t,keysPressed:e,...n})=>{const r=.2,o={w:{vy:r},a:{vx:-r},s:{vy:-r},d:{vx:r}},i=Array.from(e).filter(t=>t in o),a=t.entities.filter(t=>t.id).map(t=>i.map(t=>o[t]).reduce((t,e)=>({...t,...e}),{...t,vx:0,vy:0}));return{board:{...t,entities:[...a,...t.entities.filter(t=>!t.id)]},keysPressed:e,...n}},o=({board:t,click:e,...n})=>{if(!e)return{...n,board:t};const{x:r,y:o}=e,a=t.entities.filter(t=>t.id).map(t=>{const e=r-t.x,n=o-t.y,a=Math.sqrt(e*e+n*n),c=e/a,s=n/a,u=t.r+2+2;return i(t.x+u*c,t.y+u*s,.4*c,.4*s)});return{...n,click:e,board:{...t,entities:[...t.entities,...a]}}};function i(t,e,n,r){return{r:3,color:"black",x:t,y:e,vx:n,vy:r}}const a=function*(){const t=new Set;for(window.addEventListener("keydown",e=>{const n=e.key.toLowerCase();t.has(n)||t.add(n)}),window.addEventListener("keyup",e=>{const n=e.key.toLowerCase();t.has(n)&&t.delete(n)});;)yield t}(),c=function*(){let t=Date.now();for(;;){let e=Date.now();const n=e-t;t=e,yield n}}();!function(){let t=function(){const t=document.querySelector("canvas"),e=t.getContext("2d"),{width:n,height:r}=t,o=[{id:1,x:Math.random()*n,y:Math.random()*r,r:10,vx:0,vy:0,color:"red"}];return{ctx:e,entities:o}}();const e=t=>o(r(function({board:t,...e}){return{...e,board:{...t,entities:t.entities.filter((e,n)=>0==t.entities.filter((t,r)=>n!=r&&Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)<Math.pow(e.r+t.r,2)).length)}}}(function({board:t,...e}){const{width:n,height:r}=t.ctx.canvas;return{...e,board:{...t,entities:t.entities.map(({vx:t,vy:e,...o})=>({...o,x:o.x<0?0:o.x>n?n:o.x,y:o.y<0?0:o.y>r?n:o.y,vx:o.x-o.r<0?Math.abs(t):o.x+o.r>n?-Math.abs(t):t,vy:o.y-o.r<0?Math.abs(e):o.y+o.r>r?-Math.abs(e):e}))}}}(function({dt:t=0,board:e,...n}){return{...n,dt:t,board:{...e,entities:e.entities.map(e=>({...e,x:e.x+e.vx*t,y:e.y+e.vy*t}))}}}(t))))),n=function*(){const e=[];for(window.addEventListener("mousedown",({offsetX:n,offsetY:r})=>{e.push({x:n,y:t.ctx.canvas.height-r})});;)yield e.pop()}();requestAnimationFrame((async function r(){await new Promise((t,e)=>setTimeout(t,10));const o={board:t,dt:c.next().value,keysPressed:a.next().value,click:n.next().value};t=e(o).board,function(t){const{height:e,width:n}=t.ctx.canvas;t.ctx.clearRect(0,0,n,e),t.entities.forEach(n=>{t.ctx.beginPath(),t.ctx.arc(n.x,e-n.y,n.r,0,2*Math.PI),t.ctx.fillStyle=n.color,t.ctx.fill(),t.ctx.closePath()})}(t),requestAnimationFrame(r)}))}()}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL21vdmVtZW50LnRzIiwid2VicGFjazovLy8uL3NyYy9pbmRleC50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsImJvYXJkIiwia2V5c1ByZXNzZWQiLCJyZXN0IiwidiIsIm1hcHBpbmciLCJ3IiwidnkiLCJhIiwidngiLCJrZXlzIiwiQXJyYXkiLCJmcm9tIiwiZmlsdGVyIiwiayIsInBsYXllcnMiLCJlbnRpdGllcyIsImUiLCJpZCIsIm1hcCIsInJlZHVjZSIsInByZXYiLCJjdXIiLCJjbGljayIsIm1zZyIsIngiLCJteCIsInkiLCJteSIsImJ1bGxldHMiLCJyZWx4IiwicmVseSIsIm1hZ25pdHVkZSIsIk1hdGgiLCJzcXJ0IiwiQnVsbGV0IiwiY29sb3IiLCJrZXlzUHJlc3NlZFN0cmVhbSIsIlNldCIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJ0b0xvd2VyQ2FzZSIsImhhcyIsImFkZCIsImRlbGV0ZSIsImR0U3RyZWFtIiwiRGF0ZSIsIm5vdyIsIm5leHQiLCJkdCIsImNhbnZhcyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImN0eCIsImdldENvbnRleHQiLCJ3aWR0aCIsImhlaWdodCIsImgiLCJyYW5kb20iLCJpbml0IiwidXBkYXRlIiwibW92ZW1lbnQiLCJiMSIsImIyIiwiaiIsInBvdyIsImxlbmd0aCIsImFmdGVyQ29sbGlzaW9ucyIsImIiLCJhYnMiLCJhZnRlckJvdW5jaW5nIiwiYWZ0ZXJUaW1lU3RlcCIsImNsaWNrU3RyZWFtIiwicXVldWUiLCJvZmZzZXRYIiwib2Zmc2V0WSIsInB1c2giLCJwb3AiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJhc3luYyIsImZyYW1lIiwiUHJvbWlzZSIsIl8iLCJzZXRUaW1lb3V0IiwiY2xlYXJSZWN0IiwiZm9yRWFjaCIsImJlZ2luUGF0aCIsImFyYyIsIlBJIiwiZmlsbFN0eWxlIiwiZmlsbCIsImNsb3NlUGF0aCIsImRpc3BsYXkiXSwibWFwcGluZ3MiOiJhQUNFLElBQUlBLEVBQW1CLEdBR3ZCLFNBQVNDLEVBQW9CQyxHQUc1QixHQUFHRixFQUFpQkUsR0FDbkIsT0FBT0YsRUFBaUJFLEdBQVVDLFFBR25DLElBQUlDLEVBQVNKLEVBQWlCRSxHQUFZLENBQ3pDRyxFQUFHSCxFQUNISSxHQUFHLEVBQ0hILFFBQVMsSUFVVixPQU5BSSxFQUFRTCxHQUFVTSxLQUFLSixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTRixHQUcvREcsRUFBT0UsR0FBSSxFQUdKRixFQUFPRCxRQUtmRixFQUFvQlEsRUFBSUYsRUFHeEJOLEVBQW9CUyxFQUFJVixFQUd4QkMsRUFBb0JVLEVBQUksU0FBU1IsRUFBU1MsRUFBTUMsR0FDM0NaLEVBQW9CYSxFQUFFWCxFQUFTUyxJQUNsQ0csT0FBT0MsZUFBZWIsRUFBU1MsRUFBTSxDQUFFSyxZQUFZLEVBQU1DLElBQUtMLEtBS2hFWixFQUFvQmtCLEVBQUksU0FBU2hCLEdBQ1gsb0JBQVhpQixRQUEwQkEsT0FBT0MsYUFDMUNOLE9BQU9DLGVBQWViLEVBQVNpQixPQUFPQyxZQUFhLENBQUVDLE1BQU8sV0FFN0RQLE9BQU9DLGVBQWViLEVBQVMsYUFBYyxDQUFFbUIsT0FBTyxLQVF2RHJCLEVBQW9Cc0IsRUFBSSxTQUFT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RUFBR2tELGNBQ2xERixFQUFNRyxLQUFLLENBQUVuRCxJQUFHRSxFQUFHMUIsRUFBTW9ELElBQUlILE9BQU9NLE9BQVNtQixjQUd2Q0YsRUFBTUksTUFOSSxHQVVwQkMsdUJBQXNCQyxlQUFlQyxVQUM3QixJQUFJQyxRQUFRLENBQUNsRyxFQUFHbUcsSUFBTUMsV0FBV3BHLEVBQUcsS0FFMUMsTUFBTXlDLEVBQVcsQ0FDZnZCLFFBQ0FnRCxHQUFJSixFQUFTRyxPQUFPOUQsTUFDcEJnQixZQUFhbUMsRUFBa0JXLE9BQU85RCxNQUN0Q3FDLE1BQU9pRCxFQUFZeEIsT0FBTzlELE9BRTVCZSxFQUFRMkQsRUFBT3BDLEdBQUt2QixNQStFeEIsU0FBaUJELEdBQ2YsTUFBUXdELE9BQVFDLEVBQUdGLE1BQU9qRCxHQUFNTixFQUFFcUQsSUFBSUgsT0FDdENsRCxFQUFFcUQsSUFBSStCLFVBQVUsRUFBRyxFQUFHOUUsRUFBR21ELEdBQ3pCekQsRUFBRWdCLFNBQVNxRSxRQUFTakIsSUFDbEJwRSxFQUFFcUQsSUFBSWlDLFlBQ050RixFQUFFcUQsSUFBSWtDLElBQUluQixFQUFFM0MsRUFBR2dDLEVBQUlXLEVBQUV6QyxFQUFHeUMsRUFBRXJGLEVBQUcsRUFBRyxFQUFJa0QsS0FBS3VELElBQ3pDeEYsRUFBRXFELElBQUlvQyxVQUFZckIsRUFBRWhDLE1BQ3BCcEMsRUFBRXFELElBQUlxQyxPQUNOMUYsRUFBRXFELElBQUlzQyxjQXRGTkMsQ0FBUTNGLEdBQ1I2RSxzQkFBc0JFLE1BaEMxQiIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJpbXBvcnQgeyBFbnRpdHksIEJ1bGxldCwgTXNnIH0gZnJvbSBcIi4vaW5kZXhcIjtcblxuZXhwb3J0IGRlZmF1bHQge1xuICBhZnRlcktleXNQcmVzc2VkOiAoeyBib2FyZCwga2V5c1ByZXNzZWQsIC4uLnJlc3QgfTogTXNnKTogTXNnID0+IHtcbiAgICBjb25zdCB2ID0gMC4yO1xuICAgIGNvbnN0IG1hcHBpbmc6IHsgW3M6IHN0cmluZ106IFBhcnRpYWw8RW50aXR5PiB9ID0ge1xuICAgICAgdzogeyB2eTogdiB9LFxuICAgICAgYTogeyB2eDogLXYgfSxcbiAgICAgIHM6IHsgdnk6IC12IH0sXG4gICAgICBkOiB7IHZ4OiB2IH0sXG4gICAgfTtcblxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjb25zdCBrZXlzOiAoa2V5b2YgdHlwZW9mIG1hcHBpbmcpW10gPSBBcnJheS5mcm9tKGtleXNQcmVzc2VkKS5maWx0ZXIoXG4gICAgICAoaykgPT4gayBpbiBtYXBwaW5nXG4gICAgKTtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgY29uc3QgcGxheWVyczogRW50aXR5W10gPSBib2FyZC5lbnRpdGllc1xuICAgICAgLmZpbHRlcigoZSkgPT4gZS5pZClcbiAgICAgIC5tYXAoKHApID0+XG4gICAgICAgIGtleXNcbiAgICAgICAgICAubWFwKChrKSA9PiBtYXBwaW5nW2tdKVxuICAgICAgICAgIC5yZWR1Y2UoXG4gICAgICAgICAgICAocHJldjogRW50aXR5LCBjdXIpID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5wcmV2LFxuICAgICAgICAgICAgICAgIC4uLmN1cixcbiAgICAgICAgICAgICAgfSBhcyBFbnRpdHk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeyAuLi5wLCB2eDogMCwgdnk6IDAgfVxuICAgICAgICAgIClcbiAgICAgICk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgYm9hcmQ6IHtcbiAgICAgICAgLi4uYm9hcmQsXG4gICAgICAgIGVudGl0aWVzOiBbLi4ucGxheWVycywgLi4uYm9hcmQuZW50aXRpZXMuZmlsdGVyKChlKSA9PiAhZS5pZCldLFxuICAgICAgfSxcbiAgICAgIGtleXNQcmVzc2VkLFxuICAgICAgLi4ucmVzdCxcbiAgICB9O1xuICB9LFxuICBhZnRlck1vdXNlRG93bjogKHsgYm9hcmQsIGNsaWNrLCAuLi5tc2cgfTogTXNnKTogTXNnID0+IHtcbiAgICBpZiAoIWNsaWNrKSB7XG4gICAgICByZXR1cm4geyAuLi5tc2csIGJvYXJkIH07XG4gICAgfVxuICAgIGNvbnN0IHsgeDogbXgsIHk6IG15IH0gPSBjbGljaztcbiAgICBjb25zdCBwbGF5ZXJzID0gYm9hcmQuZW50aXRpZXMuZmlsdGVyKChlKSA9PiBlLmlkKTtcblxuICAgIGNvbnN0IGJ1bGxldHMgPSBwbGF5ZXJzLm1hcCgocCkgPT4ge1xuICAgICAgY29uc3QgcmVseCA9IG14IC0gcC54O1xuICAgICAgY29uc3QgcmVseSA9IG15IC0gcC55O1xuICAgICAgY29uc3QgbWFnbml0dWRlID0gTWF0aC5zcXJ0KHJlbHggKiByZWx4ICsgcmVseSAqIHJlbHkpO1xuXG4gICAgICBjb25zdCB2ID0gMC40O1xuICAgICAgY29uc3QgdnggPSByZWx4IC8gbWFnbml0dWRlO1xuICAgICAgY29uc3QgdnkgPSByZWx5IC8gbWFnbml0dWRlO1xuXG4gICAgICBjb25zdCByID0gcC5yICsgMiArIDI7XG5cbiAgICAgIHJldHVybiBCdWxsZXQocC54ICsgciAqIHZ4LCBwLnkgKyByICogdnksIHYgKiB2eCwgdiAqIHZ5KTtcbiAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICAuLi5tc2csXG4gICAgICBjbGljayxcbiAgICAgIGJvYXJkOiB7IC4uLmJvYXJkLCBlbnRpdGllczogWy4uLmJvYXJkLmVudGl0aWVzLCAuLi5idWxsZXRzXSB9LFxuICAgIH07XG4gIH0sXG59O1xuIiwiaW1wb3J0IG1vdmVtZW50IGZyb20gXCIuL21vdmVtZW50XCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3RhdGUge1xuICBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcbiAgZW50aXRpZXM6IEVudGl0eVtdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEVudGl0eSB7XG4gIGlkPzogbnVtYmVyO1xuICByOiBudW1iZXI7XG4gIHg6IG51bWJlcjtcbiAgeTogbnVtYmVyO1xuICB2eDogbnVtYmVyO1xuICB2eTogbnVtYmVyO1xuICBjb2xvcjogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgQ2xpY2sge1xuICB4OiBudW1iZXI7XG4gIHk6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNc2cge1xuICBib2FyZDogU3RhdGU7XG4gIGR0PzogbnVtYmVyO1xuICBrZXlzUHJlc3NlZD86IFNldDxzdHJpbmc+O1xuICBjbGljaz86IENsaWNrO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gQnVsbGV0KHg6IG51bWJlciwgeTogbnVtYmVyLCB2eDogbnVtYmVyLCB2eTogbnVtYmVyKTogRW50aXR5IHtcbiAgcmV0dXJuIHtcbiAgICByOiAzLFxuICAgIGNvbG9yOiBcImJsYWNrXCIsXG4gICAgeCxcbiAgICB5LFxuICAgIHZ4LFxuICAgIHZ5LFxuICB9O1xufVxuXG5jb25zdCBrZXlzUHJlc3NlZFN0cmVhbTogSXRlcmF0b3I8U2V0PHN0cmluZz4+ID0gKGZ1bmN0aW9uKiAoKSB7XG4gIGNvbnN0IGtleXMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlKSA9PiB7XG4gICAgY29uc3Qga2V5ID0gZS5rZXkudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoIWtleXMuaGFzKGtleSkpIHtcbiAgICAgIGtleXMuYWRkKGtleSk7XG4gICAgfVxuICB9KTtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCAoZSkgPT4ge1xuICAgIGNvbnN0IGtleSA9IGUua2V5LnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKGtleXMuaGFzKGtleSkpIHtcbiAgICAgIGtleXMuZGVsZXRlKGtleSk7XG4gICAgfVxuICB9KTtcbiAgd2hpbGUgKHRydWUpIHtcbiAgICB5aWVsZCBrZXlzO1xuICB9XG59KSgpO1xuXG5jb25zdCBkdFN0cmVhbTogSXRlcmF0b3I8bnVtYmVyPiA9IChmdW5jdGlvbiogKCkge1xuICBsZXQgcHJldiA9IERhdGUubm93KCk7XG4gIHdoaWxlICh0cnVlKSB7XG4gICAgbGV0IG5leHQgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IGR0ID0gbmV4dCAtIHByZXY7XG4gICAgcHJldiA9IG5leHQ7XG4gICAgeWllbGQgZHQ7XG4gIH1cbn0pKCk7XG5cbihmdW5jdGlvbiBtYWluKCkge1xuICAvLyBTVEFURSA6Z3JpbWFjaW5nOlxuICBsZXQgYm9hcmQgPSBpbml0KCk7XG5cbiAgY29uc3QgdXBkYXRlID0gKGU6IE1zZyk6IE1zZyA9PlxuICAgIG1vdmVtZW50LmFmdGVyTW91c2VEb3duKFxuICAgICAgbW92ZW1lbnQuYWZ0ZXJLZXlzUHJlc3NlZChcbiAgICAgICAgYWZ0ZXJDb2xsaXNpb25zKGFmdGVyQm91bmNpbmcoYWZ0ZXJUaW1lU3RlcChlKSkpXG4gICAgICApXG4gICAgKTtcblxuICBjb25zdCBjbGlja1N0cmVhbSA9IChmdW5jdGlvbiogKCkge1xuICAgIGNvbnN0IHF1ZXVlOiBDbGlja1tdID0gW107XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKHsgb2Zmc2V0WDogeCwgb2Zmc2V0WSB9KSA9PiB7XG4gICAgICBxdWV1ZS5wdXNoKHsgeCwgeTogYm9hcmQuY3R4LmNhbnZhcy5oZWlnaHQgLSBvZmZzZXRZIH0pO1xuICAgIH0pO1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICB5aWVsZCBxdWV1ZS5wb3AoKTtcbiAgICB9XG4gIH0pKCk7XG5cbiAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFzeW5jIGZ1bmN0aW9uIGZyYW1lKCkge1xuICAgIGF3YWl0IG5ldyBQcm9taXNlKChyLCBfKSA9PiBzZXRUaW1lb3V0KHIsIDEwKSk7XG5cbiAgICBjb25zdCBtc2c6IE1zZyA9IHtcbiAgICAgIGJvYXJkLFxuICAgICAgZHQ6IGR0U3RyZWFtLm5leHQoKS52YWx1ZSxcbiAgICAgIGtleXNQcmVzc2VkOiBrZXlzUHJlc3NlZFN0cmVhbS5uZXh0KCkudmFsdWUsXG4gICAgICBjbGljazogY2xpY2tTdHJlYW0ubmV4dCgpLnZhbHVlLFxuICAgIH07XG4gICAgYm9hcmQgPSB1cGRhdGUobXNnKS5ib2FyZDtcbiAgICBkaXNwbGF5KGJvYXJkKTtcbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnJhbWUpO1xuICB9KTtcbn0pKCk7XG5cbmZ1bmN0aW9uIGFmdGVyR3Jhdml0eSh7IGR0LCBib2FyZCwgLi4ubXNnIH06IE1zZyk6IE1zZyB7XG4gIGNvbnN0IHBwbCA9IGJvYXJkLmVudGl0aWVzLmZpbHRlcigoZSkgPT4gZS5pZCk7XG4gIGNvbnN0IGJ1bGxldHMgPSBib2FyZC5lbnRpdGllcy5maWx0ZXIoKGUpID0+ICFlLmlkKTtcblxuICBjb25zdCBnID0gMC4wMDA5ODE7XG5cbiAgcmV0dXJuIHtcbiAgICAuLi5tc2csXG4gICAgZHQsXG4gICAgYm9hcmQ6IHtcbiAgICAgIC4uLmJvYXJkLFxuICAgICAgZW50aXRpZXM6IFtcbiAgICAgICAgLi4ucHBsLFxuICAgICAgICAuLi5idWxsZXRzLm1hcCgoZSkgPT4gKHtcbiAgICAgICAgICAuLi5lLFxuICAgICAgICAgIHZ5OiBlLnZ5IC0gZyAqIGR0LFxuICAgICAgICB9KSksXG4gICAgICBdLFxuICAgIH0sXG4gIH07XG59XG5cbmZ1bmN0aW9uIGFmdGVyVGltZVN0ZXAoeyBkdCA9IDAsIGJvYXJkLCAuLi5tc2cgfTogTXNnKTogTXNnIHtcbiAgcmV0dXJuIHtcbiAgICAuLi5tc2csXG4gICAgZHQsXG4gICAgYm9hcmQ6IHtcbiAgICAgIC4uLmJvYXJkLFxuICAgICAgZW50aXRpZXM6IGJvYXJkLmVudGl0aWVzLm1hcCgoYykgPT4gKHtcbiAgICAgICAgLi4uYyxcbiAgICAgICAgeDogYy54ICsgYy52eCAqIGR0LFxuICAgICAgICB5OiBjLnkgKyBjLnZ5ICogZHQsXG4gICAgICB9KSksXG4gICAgfSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYWZ0ZXJDb2xsaXNpb25zKHsgYm9hcmQsIC4uLm1zZyB9OiBNc2cpOiBNc2cge1xuICByZXR1cm4ge1xuICAgIC4uLm1zZyxcbiAgICBib2FyZDoge1xuICAgICAgLi4uYm9hcmQsXG4gICAgICBlbnRpdGllczogYm9hcmQuZW50aXRpZXMuZmlsdGVyKChiMSwgaSkgPT4ge1xuICAgICAgICBjb25zdCBjb2xsaXNpb25zID0gYm9hcmQuZW50aXRpZXMuZmlsdGVyKFxuICAgICAgICAgIChiMiwgaikgPT5cbiAgICAgICAgICAgIGkgIT0gaiAmJlxuICAgICAgICAgICAgTWF0aC5wb3coYjEueCAtIGIyLngsIDIpICsgTWF0aC5wb3coYjEueSAtIGIyLnksIDIpIDxcbiAgICAgICAgICAgICAgTWF0aC5wb3coYjEuciArIGIyLnIsIDIpXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBjb2xsaXNpb25zLmxlbmd0aCA9PSAwO1xuICAgICAgfSksXG4gICAgfSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gYWZ0ZXJCb3VuY2luZyh7IGJvYXJkLCAuLi5tc2cgfTogTXNnKTogTXNnIHtcbiAgY29uc3QgeyB3aWR0aDogdywgaGVpZ2h0OiBoIH0gPSBib2FyZC5jdHguY2FudmFzO1xuXG4gIHJldHVybiB7XG4gICAgLi4ubXNnLFxuICAgIGJvYXJkOiB7XG4gICAgICAuLi5ib2FyZCxcbiAgICAgIGVudGl0aWVzOiBib2FyZC5lbnRpdGllcy5tYXAoKHsgdngsIHZ5LCAuLi5iIH0pID0+ICh7XG4gICAgICAgIC4uLmIsXG4gICAgICAgIHg6IGIueCA8IDAgPyAwIDogYi54ID4gdyA/IHcgOiBiLngsXG4gICAgICAgIHk6IGIueSA8IDAgPyAwIDogYi55ID4gaCA/IHcgOiBiLnksXG4gICAgICAgIHZ4OiBiLnggLSBiLnIgPCAwID8gTWF0aC5hYnModngpIDogYi54ICsgYi5yID4gdyA/IC1NYXRoLmFicyh2eCkgOiB2eCxcbiAgICAgICAgdnk6IGIueSAtIGIuciA8IDAgPyBNYXRoLmFicyh2eSkgOiBiLnkgKyBiLnIgPiBoID8gLU1hdGguYWJzKHZ5KSA6IHZ5LFxuICAgICAgfSkpLFxuICAgIH0sXG4gIH07XG59XG5cbmZ1bmN0aW9uIGRpc3BsYXkoczogU3RhdGUpIHtcbiAgY29uc3QgeyBoZWlnaHQ6IGgsIHdpZHRoOiB3IH0gPSBzLmN0eC5jYW52YXM7XG4gIHMuY3R4LmNsZWFyUmVjdCgwLCAwLCB3LCBoKTtcbiAgcy5lbnRpdGllcy5mb3JFYWNoKChiKSA9PiB7XG4gICAgcy5jdHguYmVnaW5QYXRoKCk7XG4gICAgcy5jdHguYXJjKGIueCwgaCAtIGIueSwgYi5yLCAwLCAyICogTWF0aC5QSSk7XG4gICAgcy5jdHguZmlsbFN0eWxlID0gYi5jb2xvcjtcbiAgICBzLmN0eC5maWxsKCk7XG4gICAgcy5jdHguY2xvc2VQYXRoKCk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBpbml0KCk6IFN0YXRlIHtcbiAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImNhbnZhc1wiKTtcbiAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgY29uc3QgeyB3aWR0aDogdywgaGVpZ2h0OiBoIH0gPSBjYW52YXM7XG4gIGNvbnN0IHBsYXllcnM6IEVudGl0eVtdID0gW1xuICAgIHtcbiAgICAgIGlkOiAxLFxuICAgICAgeDogTWF0aC5yYW5kb20oKSAqIHcsXG4gICAgICB5OiBNYXRoLnJhbmRvbSgpICogaCxcbiAgICAgIHI6IDEwLFxuICAgICAgdng6IDAsXG4gICAgICB2eTogMCxcbiAgICAgIGNvbG9yOiBcInJlZFwiLFxuICAgIH0sXG4gIF07XG5cbiAgcmV0dXJuIHtcbiAgICBjdHgsXG4gICAgZW50aXRpZXM6IHBsYXllcnMsXG4gIH07XG59XG4iXSwic291cmNlUm9vdCI6IiJ9